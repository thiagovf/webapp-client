	<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<h2 id='titulo'>Cadastrar Aluno</h2>
	<div><label>Nome:</label><input id="nome" type="text"></div>
	<div><label>Sobrenome:</label><input id="sobrenome" type="text"></div>
	<div><label>Telefone:</label><input id="telefone" type="text"></div>
	<div><label>RA:</label><input id="ra" type="text"></div>
	<div>
		<button id='btnSalvar' onClick='Cadastrar()'>Cadastrar</button>
		<button id='btnCancelar' onClick='Cancelar()'>Limpar</button>
	</div>
	<label></label>
	<table border="1">
		<thead>
			<tr>
				<td>Nome</td>
				<td>Sobrenome</td>
				<td>Telefone</td>
				<td>RA</td>
				<td>Opções</td>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<script type="text/javascript">
		var tbody = document.querySelector('table tbody');
		var aluno;
		
		function Cadastrar() {
			if (aluno === undefined || aluno == null) {
				aluno = {};
			}
			aluno.Nome = document.querySelector('#nome').value;
			aluno.Sobrenome = document.querySelector('#sobrenome').value;
			aluno.Telefone = document.querySelector('#telefone').value;
			aluno.RA = document.querySelector('#ra').value;

			if (aluno.Id === undefined || aluno.Id === 0) {
				salvarEstudante('POST', 0, aluno);
			} else {
				salvarEstudante('PUT', aluno.Id, aluno);
				aluno = null;
			}
			carregaEstudantes();
			Cancelar();
		}

		function Cancelar() {
			var titulo = document.querySelector('#titulo');
			var btnSalvar = document.querySelector('#btnSalvar');
			var btnCancelar = document.querySelector('#btnCancelar');

			titulo.textContent = 'Cadastrar Aluno'
			btnSalvar.textContent = 'Cadastrar';
			btnCancelar.textContent = 'Limpar';

			document.querySelector('#nome').value = '';
			document.querySelector('#sobrenome').value = '';
			document.querySelector('#telefone').value = '';
			document.querySelector('#ra').value = '';

			aluno = {};
		}

		function carregaEstudantes() {
			tbody.innerHTML = '';
			var xhr = new XMLHttpRequest();
			
			xhr.open('GET', `http://localhost:51441/api/Aluno/`, true);

			xhr.onload = function () {
				var estudantes = JSON.parse(this.responseText);
				for (var indice in estudantes) {
					adicionaLinha(estudantes[indice]);
				}
			}
			xhr.send();

		}

		function salvarEstudante(metodoHTTP, id, corpo) {
			var xhr = new XMLHttpRequest();
			if (id === undefined || id === 0) {
				id = '';
			}
			
			xhr.open(metodoHTTP, `http://localhost:51441/api/Aluno/${id}`, false);

			xhr.setRequestHeader('content-type', 'application/json');
			xhr.send(JSON.stringify(corpo));

		}

		carregaEstudantes('GET');

		function editarEstudante(estudante) {

			var titulo = document.querySelector('#titulo');
			var btnSalvar = document.querySelector('#btnSalvar');
			var btnCancelar = document.querySelector('#btnCancelar');

			titulo.textContent = `Editar Aluno ${estudante.Nome}`;
			btnSalvar.textContent = 'Salvar';
			btnCancelar.textContent = 'Cancelar';

			document.querySelector('#nome').value = estudante.Nome;
			document.querySelector('#sobrenome').value = estudante.Sobrenome;
			document.querySelector('#telefone').value = estudante.Telefone;
			document.querySelector('#ra').value = estudante.RA;

			aluno = estudante;

		}

		function excluirEstudante(id) {
			var xhr = new XMLHttpRequest();
			xhr.open('DELETE', `http://localhost:51441/api/Aluno/${id}`, false);
			xhr.send();
		}

		function excluir(id) {
			excluirEstudante(id);
			carregaEstudantes();
		}

		function adicionaLinha(estudante) {

			var trow = `<tr>
							<td>${estudante.Nome}</td>
							<td>${estudante.Sobrenome}</td>
							<td>${estudante.Telefone}</td>
							<td>${estudante.RA}</td>
							<td>
								<button onClick='editarEstudante(${JSON.stringify(estudante)})'>Editar</button>
								<button onClick='excluirEstudante(${estudante.Id})'>Excluir</button>
							</td>
						</tr>
						`
			tbody.innerHTML += trow;
		}
	</script>
</body>
</html>